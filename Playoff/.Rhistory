pergame=per_game_table[,c(-1,-3,-29)]
advanced=advanced_table[-13,-c(1,3:6,27)]
combined=inner_join(pergame,advanced)
FINAL=rbind(FINAL,combined)
}
safe_read_html <- function(url, retries = 3, wait = 5, timeout_sec = 60) {
for (i in seq_len(retries)) {
try({
res <- GET(
url,
user_agent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/118.0"),
timeout(timeout_sec)
)
if (status_code(res) == 200) {
return(read_html(res))
}
}, silent = TRUE)
message("Retry ", i, "/", retries, " after waiting ", wait, "s for ", url)
Sys.sleep(wait)
}
stop("Failed to connect to ", url)
}
options(timeout = 800)
FINAL=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
Sys.sleep(runif(1,8,15))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
comments <- page %>% html_nodes(xpath = '//comment()') %>% html_text()
adv_html <- comments[str_detect(comments, "players_advanced")]
adv_page <- read_html(adv_html)
advanced_table <- adv_page %>% html_table(fill = TRUE) %>% .[[1]]
per_game_table <- page %>%
html_element("#all_players_per_game table") %>%
html_table(fill = TRUE)
pergame=per_game_table[,c(-1,-3,-29)]
advanced=advanced_table[-13,-c(1,3:6,27)]
combined=inner_join(pergame,advanced)
FINAL=rbind(FINAL,combined)
}
FINAL=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
Sys.sleep(runif(1,8,15))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
comments <- page %>% html_nodes(xpath = '//comment()') %>% html_text()
adv_html <- comments[str_detect(comments, "players_advanced")]
adv_page <- safe_read_html(adv_html)
advanced_table <- adv_page %>% html_table(fill = TRUE) %>% .[[1]]
per_game_table <- page %>%
html_element("#all_players_per_game table") %>%
html_table(fill = TRUE)
pergame=per_game_table[,c(-1,-3,-29)]
advanced=advanced_table[-13,-c(1,3:6,27)]
combined=inner_join(pergame,advanced)
FINAL=rbind(FINAL,combined)
}
FINAL=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
Sys.sleep(runif(1,8,15))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
comments <- page %>% html_nodes(xpath = '//comment()') %>% html_text()
adv_html <- comments[str_detect(comments, "players_advanced")]
Sys.sleep(runif(1,8,15))
adv_page <- safe_read_html(adv_html)
advanced_table <- adv_page %>% html_table(fill = TRUE) %>% .[[1]]
per_game_table <- page %>%
html_element("#all_players_per_game table") %>%
html_table(fill = TRUE)
pergame=per_game_table[,c(-1,-3,-29)]
advanced=advanced_table[-13,-c(1,3:6,27)]
combined=inner_join(pergame,advanced)
FINAL=rbind(FINAL,combined)
}
options(timeout = 400)
ADVANCED=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
Sys.sleep(runif(1,8,15))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
comments <- page %>% html_nodes(xpath = '//comment()') %>% html_text()
adv_html <- comments[str_detect(comments, "players_advanced")]
adv_page <- read_html(adv_html)
advanced_table <- adv_page %>% html_table(fill = TRUE) %>% .[[1]]
advanced=advanced_table[-13,-c(1,3:6,27)]
ADVANCED=rbind(ADVANCED,advanced)
}
5*326
ADVANCED=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
#Sys.sleep(runif(1,8,15))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
comments <- page %>% html_nodes(xpath = '//comment()') %>% html_text()
adv_html <- comments[str_detect(comments, "players_advanced")]
adv_page <- read_html(adv_html)
advanced_table <- adv_page %>% html_table(fill = TRUE) %>% .[[1]]
advanced=advanced_table[-13,-c(1,3:6,27)]
ADVANCED=rbind(ADVANCED,advanced)
}
safe_read_html <- function(url, retries = 5, wait = 7, timeout_sec = 60) {
for (i in seq_len(retries)) {
try({
res <- GET(
url,
user_agent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/118.0"),
timeout(timeout_sec)
)
if (status_code(res) == 200) {
return(read_html(res))
}
}, silent = TRUE)
message("Retry ", i, "/", retries, " after waiting ", wait, "s for ", url)
Sys.sleep(wait)
}
stop("Failed to connect to ", url)
}
options(timeout = 400)
ADVANCED=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
#Sys.sleep(runif(1,8,15))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
comments <- page %>% html_nodes(xpath = '//comment()') %>% html_text()
adv_html <- comments[str_detect(comments, "players_advanced")]
adv_page <- read_html(adv_html)
advanced_table <- adv_page %>% html_table(fill = TRUE) %>% .[[1]]
advanced=advanced_table[-13,-c(1,3:6,27)]
ADVANCED=rbind(ADVANCED,advanced)
}
safe_read_html <- function(url, retries = 5, wait = 7, timeout_sec = 60) {
for (i in seq_len(retries)) {
try({
res <- GET(
url,
user_agent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/118.0"),
timeout(timeout_sec)
)
if (status_code(res) == 200) {
return(read_html(res))
}
}, silent = TRUE)
message("Retry ", i, "/", retries, " after waiting ", wait, "s for ", url)
Sys.sleep(wait)
}
stop("Failed to connect to ", url)
}
options(timeout = 400)
ADVANCED=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
Sys.sleep(runif(1,3,5))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
comments <- page %>% html_nodes(xpath = '//comment()') %>% html_text()
adv_html <- comments[str_detect(comments, "players_advanced")]
adv_page <- read_html(adv_html)
advanced_table <- adv_page %>% html_table(fill = TRUE) %>% .[[1]]
advanced=advanced_table[-13,-c(1,3:6,27)]
ADVANCED=rbind(ADVANCED,advanced)
}
safe_read_html <- function(url, retries = 5, wait = 5, timeout_sec = 120) {
for (i in seq_len(retries)) {
try({
res <- GET(
url,
user_agent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/118.0"),
timeout(timeout_sec)
)
if (status_code(res) == 200) {
return(read_html(res))
}
}, silent = TRUE)
message("Retry ", i, "/", retries, " after waiting ", wait, "s for ", url)
Sys.sleep(wait)
}
stop("Failed to connect to ", url)
}
options(timeout = 400)
ADVANCED=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
Sys.sleep(runif(1,3,5))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
comments <- page %>% html_nodes(xpath = '//comment()') %>% html_text()
adv_html <- comments[str_detect(comments, "players_advanced")]
adv_page <- read_html(adv_html)
advanced_table <- adv_page %>% html_table(fill = TRUE) %>% .[[1]]
advanced=advanced_table[-13,-c(1,3:6,27)]
ADVANCED=rbind(ADVANCED,advanced)
}
safe_read_html <- function(url, retries = 5, wait = 5, timeout_sec = 300) {
for (i in seq_len(retries)) {
try({
res <- GET(
url,
user_agent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/118.0"),
timeout(timeout_sec)
)
if (status_code(res) == 200) {
return(read_html(res))
}
}, silent = TRUE)
message("Retry ", i, "/", retries, " after waiting ", wait, "s for ", url)
Sys.sleep(wait)
}
stop("Failed to connect to ", url)
}
ADVANCED=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
Sys.sleep(runif(1,3,5))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
comments <- page %>% html_nodes(xpath = '//comment()') %>% html_text()
adv_html <- comments[str_detect(comments, "players_advanced")]
adv_page <- read_html(adv_html)
advanced_table <- adv_page %>% html_table(fill = TRUE) %>% .[[1]]
advanced=advanced_table[-13,-c(1,3:6,27)]
ADVANCED=rbind(ADVANCED,advanced)
}
safe_read_html <- function(url, retries = 5, wait = 5, timeout_sec = 300) {
for (i in seq_len(retries)) {
try({
res <- GET(
url,
user_agent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/118.0"),
timeout(timeout_sec)
)
if (status_code(res) == 200) {
return(read_html(res))
}
}, silent = TRUE)
message("Retry ", i, "/", retries, " after waiting ", wait, "s for ", url)
Sys.sleep(wait)
}
stop("Failed to connect to ", url)
}
ADVANCED=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
#Sys.sleep(runif(1,3,5))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
comments <- page %>% html_nodes(xpath = '//comment()') %>% html_text()
adv_html <- comments[str_detect(comments, "players_advanced")]
adv_page <- read_html(adv_html)
advanced_table <- adv_page %>% html_table(fill = TRUE) %>% .[[1]]
advanced=advanced_table[-13,-c(1,3:6,27)]
ADVANCED=rbind(ADVANCED,advanced)
}
safe_read_html <- function(url, retries = 5, wait = 5, timeout_sec = 300) {
for (i in seq_len(retries)) {
try({
res <- GET(
url,
user_agent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/118.0"),
timeout(timeout_sec)
)
if (status_code(res) == 200) {
return(read_html(res))
}
}, silent = TRUE)
message("Retry ", i, "/", retries, " after waiting ", wait, "s for ", url)
Sys.sleep(wait)
}
stop("Failed to connect to ", url)
}
ADVANCED=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
#Sys.sleep(runif(1,3,5))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
comments <- page %>% html_nodes(xpath = '//comment()') %>% html_text()
adv_html <- comments[str_detect(comments, "players_advanced")]
adv_page <- read_html(adv_html)
advanced_table <- adv_page %>% html_table(fill = TRUE) %>% .[[1]]
advanced=advanced_table[-13,-c(1,3:6,27)]
ADVANCED=rbind(ADVANCED,advanced)
}
#Loop and Webscrape for All Teams
options(timeout_seconds=5000)
options(timeout_seconds=5000)
safe_read_html <- function(url, retries = 5, wait = 7, timeout_sec = 3000) {
for (i in seq_len(retries)) {
try({
res <- GET(
url,
user_agent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/118.0"),
timeout(timeout_sec)
)
if (status_code(res) == 200) {
return(read_html(res))
}
}, silent = TRUE)
message("Retry ", i, "/", retries, " after waiting ", wait, "s for ", url)
Sys.sleep(wait)
}
stop("Failed to connect to ", url)
}
ADVANCED=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
#Sys.sleep(runif(1,3,5))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
comments <- page %>% html_nodes(xpath = '//comment()') %>% html_text()
adv_html <- comments[str_detect(comments, "players_advanced")]
adv_page <- read_html(adv_html)
advanced_table <- adv_page %>% html_table(fill = TRUE) %>% .[[1]]
advanced=advanced_table[-13,-c(1,3:6,27)]
ADVANCED=rbind(ADVANCED,advanced)
}
PERGAME=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
Sys.sleep(runif(1,3,5))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
per_game_table <- page %>%
html_element("#all_players_per_game table") %>%
html_table(fill = TRUE)
pergame=per_game_table[,c(-1,-3,-29)]
PERGAME=rbind(PERGAME,pergame)
}
#Loop and Webscrape for All Teams
options(timeout_seconds=5000)
safe_read_html <- function(url, retries = 5, wait = 7, timeout_sec = 3000) {
for (i in seq_len(retries)) {
try({
res <- GET(
url,
user_agent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/118.0"),
timeout(timeout_sec)
)
if (status_code(res) == 200) {
return(read_html(res))
}
}, silent = TRUE)
message("Retry ", i, "/", retries, " after waiting ", wait, "s for ", url)
Sys.sleep(wait)
}
stop("Failed to connect to ", url)
}
ADVANCED=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
#Sys.sleep(runif(1,3,5))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
comments <- page %>% html_nodes(xpath = '//comment()') %>% html_text()
adv_html <- comments[str_detect(comments, "players_advanced")]
adv_page <- read_html(adv_html)
advanced_table <- adv_page %>% html_table(fill = TRUE) %>% .[[1]]
advanced=advanced_table[-13,-c(1,3:6,27)]
ADVANCED=rbind(ADVANCED,advanced)
}
ADVANCED=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
#Sys.sleep(runif(1,3,5))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
comments <- page %>% html_nodes(xpath = '//comment()') %>% html_text()
adv_html <- comments[str_detect(comments, "players_advanced")]
adv_page <- read_html(adv_html)
advanced_table <- adv_page %>% html_table(fill = TRUE) %>% .[[1]]
advanced=advanced_table[-13,-c(1,3:6,27)]
ADVANCED=rbind(ADVANCED,advanced)
}
PERGAME=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
#Sys.sleep(runif(1,3,5))
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
per_game_table <- page %>%
html_element("#all_players_per_game table") %>%
html_table(fill = TRUE)
pergame=per_game_table[,c(-1,-3,-29)]
PERGAME=rbind(PERGAME,pergame)
}
PERGAME=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
#Sys.sleep(runif(1,3,5))
url <- SCHOOLURLS[i]
page <- read_html(url)
per_game_table <- page %>%
html_element("#all_players_per_game table") %>%
html_table(fill = TRUE)
pergame=per_game_table[,c(-1,-3,-29)]
PERGAME=rbind(PERGAME,pergame)
}
PERGAME=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
#Sys.sleep(runif(1,3,5))
url <- SCHOOLURLS[i]
page <- read_html(url)
per_game_table <- page %>%
html_element("#all_players_per_game table") %>%
html_table(fill = TRUE)
pergame=per_game_table[,c(-1,-3,-29)]
PERGAME=rbind(PERGAME,pergame)
}
PERGAME=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
#Sys.sleep(runif(1,3,5))
url <- SCHOOLURLS[i]
page <- read_html(url)
per_game_table <- page %>%
html_element("#all_players_per_game table") %>%
html_table(fill = TRUE)
pergame=per_game_table[,c(-1,-3,-29)]
PERGAME=rbind(PERGAME,pergame)
}
PERGAME=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
#Sys.sleep(runif(1,3,5))
url <- SCHOOLURLS[i]
page <- read_html(url)
per_game_table <- page %>%
html_element("#all_players_per_game table") %>%
html_table(fill = TRUE)
pergame=per_game_table[,c(-1,-3,-29)]
PERGAME=rbind(PERGAME,pergame)
}
safe_read_html <- function(url, max_tries = 5, wait_seconds = 3, max_wait = 60) {
for (i in seq_len(max_tries)) {
try({
# Send GET request with a realistic User-Agent
res <- GET(
url,
user_agent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36")
)
# Handle 429 Too Many Requests
if (status_code(res) == 429) {
# Check Retry-After header (if present)
retry_after <- as.numeric(headers(res)[["Retry-After"]])
if (is.na(retry_after)) retry_after <- wait_seconds
retry_after <- min(retry_after, max_wait)
message(sprintf("HTTP 429 received. Waiting %d seconds before retrying...", retry_after))
Sys.sleep(retry_after)
next
}
# Successful request
if (status_code(res) == 200) {
page <- read_html(res)
return(page)
} else {
message(sprintf("Attempt %d: Failed with status %d", i, status_code(res)))
Sys.sleep(wait_seconds)
}
}, silent = TRUE)
# Exponential backoff for other errors
Sys.sleep(wait_seconds * i)
}
warning(sprintf("Failed to read URL after %d attempts: %s", max_tries, url))
return(NULL)
}
ADVANCED=NULL
for(i in (1:length(SCHOOLURLS))){
print(i)
url <- SCHOOLURLS[i]
page <- safe_read_html(url)
comments <- page %>% html_nodes(xpath = '//comment()') %>% html_text()
adv_html <- comments[str_detect(comments, "players_advanced")]
adv_page <- read_html(adv_html)
advanced_table <- adv_page %>% html_table(fill = TRUE) %>% .[[1]]
advanced=advanced_table[-13,-c(1,3:6,27)]
ADVANCED=rbind(ADVANCED,advanced)
}
#Code Below Doesn't Work (Uncomment and Check)
TEAMURL=SCHOOLURLS[52]
OUT = read_html(TEAMURL) %>%
html_nodes(css="#players_advanced .left , #players_advanced .right, #players_advanced .center")
PERGAME = OUT[[6]][,c(-1,-5)]
ADVANCED = OUT[[14]][,-c(1,3,4,20,25)]
PLAYERMERGE=inner_join(PERGAME,ADVANCED,by="Player")
Stats_URL="https://www.sports-reference.com/cbb/seasons/women/2025-school-stats.html"
ALL=read_html(Stats_URL) %>%
html_table() %>%
.[[1]]
install.packages("RSelenium")
library(RSelenium)
library(rvest)
library(dplyr)
# Start RSelenium (Chrome)
rD <- rsDriver(browser = "chrome", port = 4545L, chromever = "latest")
install.packages("JavaGD")
library(RSelenium)
library(rvest)
library(dplyr)
# Start RSelenium (Chrome)
rD <- rsDriver(browser = "chrome", port = 4545L, chromever = "latest")
library(RSelenium)
library(rvest)
library(dplyr)
# Start RSelenium (Chrome)
rD <- rsDriver(browser = "chrome", port = 4545L, chromever = "latest")
